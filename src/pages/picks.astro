---
import BaseLayout from '../layouts/BaseLayout.astro';
import Card from '../components/Card.astro';
import Modal from '../components/Modal.astro';
import { getCollection } from 'astro:content';

const allPicks = await getCollection('picks');

// Get category from URL params
const url = new URL(Astro.request.url);
const selectedCategory = url.searchParams.get('category');

// Filter picks if category is selected
const filteredPicks = selectedCategory
  ? allPicks.filter(p => p.data.category.toLowerCase() === selectedCategory.toLowerCase())
  : allPicks;

const categories = ['All', 'Camping', 'Workshop', 'Kitchen', 'Tech', 'Garden', 'Sports'];
---

<BaseLayout title="All Picks">
  <div class="container mx-auto px-4 py-12">
    <h1 class="text-4xl font-bold text-gray-900 dark:text-white mb-8 text-center">All GeckoRoo Picks</h1>

    <!-- Category Filter -->
    <div class="flex flex-wrap gap-2 justify-center mb-8">
      {categories.map((cat) => (
        <a
          href={cat === 'All' ? '/picks' : `/picks?category=${cat.toLowerCase()}`}
          class={`px-4 py-2 rounded-full font-semibold transition-colors ${
            (cat === 'All' && !selectedCategory) || (selectedCategory === cat.toLowerCase())
              ? 'bg-gecko-600 text-white'
              : 'bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600'
          }`}
        >
          {cat}
        </a>
      ))}
    </div>

    <!-- Results count -->
    <p class="text-center text-gray-600 dark:text-gray-400 mb-8">
      Showing {filteredPicks.length} {filteredPicks.length === 1 ? 'product' : 'products'}
      {selectedCategory && ` in ${selectedCategory.charAt(0).toUpperCase() + selectedCategory.slice(1)}`}
    </p>

    <!-- Products Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
      {filteredPicks.map((pick) => (
        <>
          <Card
            title={pick.data.title}
            slug={pick.slug}
            category={pick.data.category}
            blurb={pick.data.blurb}
            priceHint={pick.data.price_hint}
            image={pick.data.image}
            badges={pick.data.badges}
            featured={pick.data.featured}
          />
          <Modal
            id={pick.slug}
            title={pick.data.title}
            pros={pick.data.pros}
            cons={pick.data.cons}
            videoId={pick.data.yt_video_id}
          />
        </>
      ))}
    </div>

    {filteredPicks.length === 0 && (
      <div class="text-center py-12">
        <p class="text-gray-600 dark:text-gray-400 text-lg">
          No products found in this category yet. Check back soon!
        </p>
      </div>
    )}
  </div>
</BaseLayout>